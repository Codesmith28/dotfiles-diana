---
- name: Detect GPU
  ansible.builtin.shell: set -o pipefail && lspci | grep -i 'VGA\|3D\|display'
  register: gpu_result
  changed_when: no

# TODO: Also add a check for legacy cards and their recommended versions.
#       Maybe find an actively maintained API made for this purpose? - kurtbahartr
- name: Check if you have a nvidia card for additional configuration
  set_fact:
    is_nvidia: "{{ 'nvidia' in gpu_result.stdout.lower() }}"

# I know this was not supposed to be like this as per the aforementioned TODO.
# I am still cooking. This is just the initials for me to put on top.
- name: Check if your nvidia card is supported by the latest proprietary drivers
  set_fact:
    new_nvidia: true
  when:
    - is_nvidia
    - proprietary_nvidia_drivers

- name: "GPU Drivers | Checking for Distribution Config: {{ ansible_distribution }}"
  ansible.builtin.stat:
    path: "pre_tasks/gpu_drivers/{{ ansible_distribution }}.yml"
  register: gpu_drivers_distribution_config

- name: "GPU Drivers | Run Tasks: {{ ansible_distribution }}"
  ansible.builtin.include_tasks: "{{ ansible_distribution }}.yml"
  when: gpu_drivers_distribution_config.stat.exists
